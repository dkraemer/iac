{
    "variables": {
        "dev_mode": "no",
        "vm_name": "base-ubuntu-18.04",
        "vm_attach_snapshot": "packing",
        "vm_target_snapshot": "packed",
        "vm_user": "ubuntu",
        "vm_password": "ubuntu",
        "vm_compact": "yes"
    },
    "builders": [
        {
            "type": "virtualbox-vm",
            "communicator": "ssh",
            "name": "{{user `vm_name`}}",
            "vm_name": "{{user `vm_name`}}",
            "attach_snapshot": "{{user `vm_attach_snapshot`}}",
            "target_snapshot": "{{user `vm_target_snapshot`}}",
            "shutdown_command": "sudo systemctl poweroff",
            "ssh_username": "{{user `vm_user`}}",
            "ssh_password": "{{user `vm_password`}}",
            "skip_export": false,
            "headless": true,
            "force_delete_snapshot": false,
            "keep_registered": false,
            "output_directory": "output"
        }
    ],
    "provisioners": [
        {
            "type": "shell-local",
            "command": "tar -cvzf files.tar.gz files"
        },
        {
            "type": "file",
            "source": "files.tar.gz",
            "destination": "files.tar.gz",
            "generated": true
        },
        {
            "type": "shell",
            "environment_vars": [
                "DEV_MODE={{user `dev_mode`}}",
                "PASSWORD={{user `vm_password`}}",
                "COMPACT={{user `vm_compact`}}"
            ],
            "script": "provision.sh",
            "expect_disconnect": true
        }
    ]
}