{
    "variables": {
        "vm_name": "base-ubuntu-18.04",
        "vm_attach_snapshot": "packing",
        "vm_target_snapshot": "packed",
        "vm_user": "ubuntu",
        "vm_password": "ubuntu",
        "vm_compact": "yes"
    },
    "builders": [
        {
            "type": "virtualbox-vm",
            "communicator": "ssh",
            "vm_name": "{{user `vm_name`}}",
            "attach_snapshot": "{{user `vm_attach_snapshot`}}",
            "headless": false,
            "skip_export": true,
            "target_snapshot": "{{user `vm_target_snapshot`}}",
            "shutdown_command": "sudo systemctl poweroff",
            "ssh_username": "{{user `vm_user`}}",
            "ssh_password": "{{user `vm_password`}}",
            "force_delete_snapshot": false
        }
    ],
    "provisioners": [
        {
            "type": "file",
            "source": "grub",
            "destination": "grub"
        },
        {
            "type": "file",
            "source": "noclear.conf",
            "destination": "noclear.conf"
        },
        {
            "type": "file",
            "source": "bash_aliases",
            "destination": ".bash_aliases"
        },
        {
            "type": "file",
            "source": "../../id_rsa.pub",
            "destination": "authorized_keys"
        },
        {
            "type": "file",
            "source": "zerofree.sh",
            "destination": "zerofree.sh"
        },
        {
            "type": "file",
            "source": "zerofree.service",
            "destination": "zerofree.service"
        },
        {
            "type": "file",
            "source": "zerofree.target",
            "destination": "zerofree.target"
        },
        {
            "type": "shell",
            "environment_vars": [
                "PASSWORD={{user `vm_password`}}",
                "COMPACT={{user `vm_compact`}}"
            ],
            "script": "provision.sh",
            "expect_disconnect": true
        }
    ]
}